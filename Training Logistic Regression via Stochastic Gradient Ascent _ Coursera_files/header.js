define("pages/open-course/item/views/header",["require","exports","module","bundles/course-preview/components/JoinCourseBanner","bundles/ondemand/actions/S12nActions","bundles/ondemand/appContextSingleton","bundles/ondemand/components/sessions/SessionEnrollBanner","bundles/ondemand/sessions/lib/experiment","bundles/ondemand/stores/SessionStore","bundles/page/common/headerTypeToProps","bundles/page/components/PageHeader","bundles/phoenix/lib/multitrackerMixin","bundles/phoenix/lib/view","bundles/phoenix/template/models/userAuthorization","bundles/phoenix/template/models/userIdentity","bundles/page/lib/metatagsAddressBook","js/app/config","js/lib/coursera.redirect","js/lib/ReactRouterAdapter","js/lib/jade._h","pages/open-course/common/constants","pages/open-course/item/views/header.html"],function(require,exports,module){"use strict";var m=require("bundles/course-preview/components/JoinCourseBanner"),u=require("bundles/ondemand/actions/S12nActions"),c=u.loadS12n,t=require("bundles/ondemand/appContextSingleton"),x=require("bundles/ondemand/components/sessions/SessionEnrollBanner"),s=require("bundles/ondemand/sessions/lib/experiment").isSessionsEnabled,a=require("bundles/ondemand/stores/SessionStore"),r=require("bundles/page/common/headerTypeToProps"),d=require("bundles/page/components/PageHeader"),l=require("bundles/phoenix/lib/multitrackerMixin"),o=require("bundles/phoenix/lib/view"),e=require("bundles/phoenix/template/models/userAuthorization"),n=require("bundles/phoenix/template/models/userIdentity"),p=require("bundles/page/lib/metatagsAddressBook"),g=require("js/app/config"),h=require("js/lib/coursera.redirect"),b=require("js/lib/ReactRouterAdapter"),k=require("js/lib/jade._h"),i=require("pages/open-course/common/constants"),f=require("pages/open-course/item/views/header.html"),M=o.extend({name:"itemHeader",multitracker:{namespace:"open_course.item_page",baseValues:["open_course_slug","item_id","item_name"],definitions:{open_course_slug:i.courseSlug,item_id:function item_id(){return this.itemMetadata.getId()},item_name:function item_name(){return this.itemMetadata.getName()}},events:{"outline_link.click":'click [data-js~="outline-link"]'},eventingVersion:2},events:{'click [data-js~="dashboard-link"]':"onDashboardLinkClick",'click [data-js~="login-link"]':"onLogInClick",'click [data-js~="signup-link"]':"onSignUpClick"},params:{required:["itemMetadata"],optional:["verificationDisplay","enrollmentMode","showLogo"]},initialize:function initialize(e){this.bind("view:merged",this.onMerge,this)},onMerge:function onMerge(e){this.itemMetadata=e.itemMetadata,this.renderBanners()},renderBanners:function renderBanners(){var e=this,i=this.model.get("id"),o=this.model.get("slug");s(i,o).then(function(i){if(i){if(n.get("authenticated")&&a.isPreviewMode())return t.getActionContext().executeAction(c).then(function(){e.renderReactInto(x,"SessionEnrollBanner",{courseName:e.model.get("name"),courseId:e.model.get("id"),itemMetadata:e.itemMetadata},t.getComponentContext())})}else"EXPLICIT"===e.enrollmentMode&&e.renderReactInto(m,"JoinCourseBanner",{},{course:e.model,track:e.track.bind(e)})})},renderMetatag:function renderMetatag(){p.setMetatags({pageName:"title-and-description",context:{title:this.itemMetadata?this.itemMetadata.get("lesson.module.name"):"Coursera"}})},render:function render(){return this.$el.html(f({_h:k,config:g,constants:i,course:this.model,userIdentity:n,userAuthorization:e,showLogo:this.showLogo||!1})),this.renderReactInto(d,"PageHeader",r.ondemand,{router:b.rr}),this.renderMetatag(),this.renderBanners(),this},onDashboardLinkClick:function onDashboardLinkClick(){this.track("dashboard_link.click"),n.get("authenticated")?h.setLocation("/"):e.ensureAuthenticated()},onLogInClick:function onLogInClick(){this.track("sign_in_link.click"),e.ensureAuthenticated({mode:"login"})},onSignUpClick:function onSignUpClick(){this.track("sign_up_link.click"),e.ensureAuthenticated({mode:"signup"})}});module.exports=M.extend(l)});