define("bundles/ondemand/components/menu/Menu",["require","exports","module","classnames","react-router","react-with-addons","js/app/retracked","bundles/ondemand/actions/ViewActionCreators","bundles/ondemand/components/CourseHeader","bundles/ondemand/components/menu/FullMenuItems","bundles/ondemand/components/menu/PreviewMenuItems","bundles/ondemand/constants/Constants","bundles/ondemand/stores/MenuStore","bundles/ondemand/utils/isPreviewMode","bundles/ondemand/utils/lastSeenWeek","bundles/ondemand/stores/SessionStore","bundles/ondemand/utils/url","bundles/phoenix/utils/matchMedia","pages/open-course/common/models/course","bundles/phoenix/lib/waitForStores","css!./__styles__/Menu"],function(require,exports,module){"use strict";var t=require("classnames"),m=require("react-router"),y=m.State,e=require("react-with-addons"),c=require("js/app/retracked"),S=require("bundles/ondemand/actions/ViewActionCreators"),r=require("bundles/ondemand/components/CourseHeader"),u=require("bundles/ondemand/components/menu/FullMenuItems"),d=require("bundles/ondemand/components/menu/PreviewMenuItems"),a=require("bundles/ondemand/constants/Constants"),n=a.mainNavItems,o=require("bundles/ondemand/stores/MenuStore"),P=require("bundles/ondemand/utils/isPreviewMode"),h=require("bundles/ondemand/utils/lastSeenWeek"),p=h.getLastSeenWeek,b=require("bundles/ondemand/stores/SessionStore"),M=require("bundles/ondemand/utils/url"),i=M.getWeekUrl,g=require("bundles/phoenix/utils/matchMedia"),v=g.isAboveHeight,C=require("pages/open-course/common/models/course"),f=require("bundles/phoenix/lib/waitForStores"),w=650;require("css!./__styles__/Menu");var s=e.createClass({displayName:"Menu",contextTypes:{router:e.PropTypes.object.isRequired},propTypes:{onUpdate:e.PropTypes.func.isRequired,course:e.PropTypes.instanceOf(C).isRequired,currentWeek:e.PropTypes.number.isRequired,isCourseComplete:e.PropTypes.bool.isRequired,passedWithVerification:e.PropTypes.bool.isRequired,isPreviewMode:e.PropTypes.bool.isRequired},statics:{getStateFromStores:function getStateFromStores(){return{showingMobileMenu:o.showingMobileMenu()}}},getInitialState:function getInitialState(){return s.getStateFromStores()},componentWillMount:function componentWillMount(){this.setSelectedNavItem()},componentDidMount:function componentDidMount(){o.addChangeListener(this.handleChange),this.props.onUpdate(),document.body.style.overflow="hidden"},componentWillReceiveProps:function componentWillReceiveProps(e){this.handleChange(e),this.setSelectedNavItem()},componentDidUpdate:function componentDidUpdate(){this.props.onUpdate()},componentWillUnmount:function componentWillUnmount(){o.removeChangeListener(this.handleChange),document.body.style.overflow="visible"},handleChange:function handleChange(){this.setState(s.getStateFromStores())},getScheduleUrl:function getScheduleUrl(){var e=p();if(e)return i(e);var n=this.props.currentWeek||1;return i(n)},setSelectedNavItem:function setSelectedNavItem(){var t=this.context.router.routes,s=t.length-1,e=t[s].name;"welcome"===e?e=n.HOME:"assignments"===e?e=n.ASSIGNMENTS:"week"===e||"ty"===e||"module"===e?e=n.COURSE:this.context.router.isActive({name:"discussions"})?e=n.DISCUSSIONS:"info"===e||"CDP"===e?e=n.INFO:e&&e.indexOf("resources")>=0&&(e=n.REFERENCES),this.setState({selectedItem:e})},hideMobileMenu:function hideMobileMenu(){this.state.showingMobileMenu&&S.toggleMobileMenu()},render:function render(){var n=this.props.course,o=t("rc-Menu","align-self-stretch","theme-dark",{"showing-mobile-menu":this.state.showingMobileMenu}),i=t("menu","od-dark","od-menu-bar","theme-dark",{"vertical-box":v(w)}),a=t("mobile-menu-overlay","bt3-visible-xs",{"hide-mobile-menu":!this.state.showingMobileMenu}),s={hideMobileMenu:this.hideMobileMenu,selectedItem:this.state.selectedItem,scheduleUrl:this.getScheduleUrl(),courseId:n.get("id")};return e.createElement("div",{className:o},e.createElement("div",{className:i,ref:"menu"},!!n&&n.has("name")&&n.has("universities")&&e.createElement(r,{thumbnail:n.getFirstPartnerSquareLogo(),universities:n.get("universities")}),this.props.isPreviewMode?e.createElement(d,s):e.createElement(u,s)),e.createElement("div",{className:a,onClick:this.hideMobileMenu}))}}),l=c.createTrackedContainer(function(){return{namespace:{page:"menu"}}})(s);module.exports=f(l,["CourseScheduleStore","CourseStore","CourseViewGradeStore","CourseMembershipStore"],function(e,i){var n=e.CourseScheduleStore,t=e.CourseStore,s=e.CourseViewGradeStore,o=e.CourseMembershipStore;return{course:t.getMetadata(),currentWeek:n.getCurrentWeek(),isCourseComplete:n.isCourseComplete(),passedWithVerification:s.hasPassedCourseWithVerification(),isPreviewMode:P(b.isPreviewMode(),o.isEnrolled())}})});